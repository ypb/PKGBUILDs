pkgname=mit-krb5
pkgver=1.8.3
pkgrel=1
pkgdesc="MIT Kerberos V"
arch=('i686' 'x86_64')
url='http://web.mit.edu/kerberos/www/'
license=('as-is')
provides=('kerberos')
backup=('etc/mit-krb5/krb5.conf' 'etc/mit-krb5/kdc.conf')
depends=('glibc' 'tcp_wrappers' 'e2fsprogs' 'db' 'openssl' 'bison')
source=("http://web.mit.edu/kerberos/dist/krb5/1.8/krb5-${pkgver}-signed.tar" kadmind.rc kdc.rc)
md5sums=('7c5f38e31ee744cb538eed2301096b93'
         '653720c7e15e6d07dd105929ab59bbef'
         'cafcc7ee341e60777da601f31352e84b')
                  
build() {
    cd ${startdir}/src
    tar --no-same-owner -xzf krb5-${pkgver}.tar.gz || return 1
    cd ${startdir}/src/krb5-${pkgver}/src
    ./configure --prefix=/opt/mit-krb5 --enable-shared --enable-dns-for-realm --enable-kdc-replay-cache \
	--localstatedir=/opt/mit-krb5/var --sysconfdir=/etc/mit-krb5 --bindir=/opt/mit-krb5 \
	--sbindir=/opt/mit-krb5 --with-system-ss \
	|| return 1
    make -j1 || return 1
    make DESTDIR=${startdir}/pkg install || return 1
    #rm ${startdir}/pkg/usr/bin/compile_et
    #rm ${startdir}/pkg/usr/lib/libcom_err.so
    #rm ${startdir}/pkg/usr/bin/telnet
    #rm ${startdir}/pkg/usr/share/et/et_c.awk
    #rm ${startdir}/pkg/usr/share/et/et_h.awk
    install -D -m 644 ${startdir}/src/krb5-${pkgver}/src/config-files/kdc.conf ${startdir}/pkg/etc/mit-krb5/kdc.conf || return 1
    install -D -m 644 ${startdir}/src/krb5-${pkgver}/src/config-files/krb5.conf ${startdir}/pkg/etc/mit-krb5/krb5.conf || return 1
    install -D -m 755 ${startdir}/src/kdc.rc ${startdir}/pkg/etc/rc.d/mit-krb5kdc || return 1
    install -D -m 755 ${startdir}/src/kadmind.rc ${startdir}/pkg/etc/rc.d/mit-krb5kadmind || return 1
    mkdir -p ${startdir}/pkg/opt/mit-krb5/bin
    ln -s ../krb5-config ${startdir}/pkg/opt/mit-krb5/bin/
}

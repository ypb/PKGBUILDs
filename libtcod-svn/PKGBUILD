# Maintainer: Kevin Whitaker <eyecreate at gmail dot com>

pkgname=libtcod-svn
pkgver=430
pkgrel=1
pkgdesc="Rougelike graphics/utility library"
arch=('i686' 'x86_64')
url="http://doryen.eptalys.net/libtcod/"
license=('BSD')
depends=('libpng' 'sdl' 'zlib' 'libgl')
makedepends=('subversion')
source=()
md5sums=()

_svntrunk=http://doryen.eptalys.net/svn-libtcod/trunk
_svnmod=libtcod


build() {
  cd $srcdir  
  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up -r $pkgver)
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
  fi
  cd $_svnmod
  sed -i '33d' $srcdir/$_svnmod/src/sys_sdl_img_png.c
  sed -i '35d' $srcdir/$_svnmod/src/sys_sdl_img_png.c
if [ "${CARCH}" = "x86_64" ]; then
  make -f makefiles/makefile-linux64 || return 1
elif ["${CARCH}" = "i686"]; then
  make -f makefiles/makefile-linux ||return 1
fi
  mkdir -p $pkgdir/usr/lib ||return 1
  mkdir -p $pkgdir/usr/include/libtcod ||return 1
  cp $srcdir/$_svnmod/{libtcodgui.so,libtcodxx.so,libtcod.so} $pkgdir/usr/lib ||return 1
  cp -r $srcdir/$_svnmod/include/* $pkgdir/usr/include/libtcod ||return 1
  rm -r $srcdir/$_svnmod/src/sys_sdl_img_png.c ||return 1
}
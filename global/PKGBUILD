# Author: timlee <tl1234562004.at.yahoo.com>
# Contributor: Philipp Robbel <robbel@gmail.com>
# Contributor: Michal Kowalski <kowalski TOD michal TA gmail TOD com>
#

pkgname=global
pkgver=5.9.3
pkgrel=2
pkgdesc="A source code tag system"
arch=(i686 x86_64)
url="http://www.gnu.org/software/global/"
license=('GPL')
groups=('ypb')
depends=()
# makedepends=('emacs')
optdepends=('idutils: enables the -I flag in global(1)'
            'perl>=4: enables the support of --form and --dynamic in htags(1)'
            'emacs: gtags.elc')
backup=('etc/gtags.conf')
# options=(!emptydirs)
source=(http://tamacom.com/global/$pkgname-$pkgver.tar.gz gtags.conf.patch makefiles.am.diff)

build() {
	cd $srcdir/$pkgname-$pkgver

	patch -p1 < ../makefiles.am.diff
	automake -a
	./configure --prefix=/usr
	make
}

package() {
	cd $srcdir/$pkgname-$pkgver

	make DESTDIR=$pkgdir install
	rmdir $pkgdir/usr/include

	# copy gtags.conf and apply patch
	mkdir -p $pkgdir/etc
	cp $pkgdir/usr/share/gtags/gtags.conf $pkgdir/etc
	patch $pkgdir/etc/gtags.conf $srcdir/gtags.conf.patch

	# symbolic link to gtags.el
	#mkdir -p $pkg/usr/share/emacs/site-lisp
	#ln -s /usr/share/gtags/gtags.el $pkgdir/usr/share/emacs/site-lisp/gtags.el
	# not needed now, but bytecompilation generates:
	#==> WARNING: Package contains reference to $srcdir
}

md5sums=('2c07f065f3e37c6333569f3af1fbbe5d'
         'c6b102c9e0b14d631fd8f7231842f65b'
         'da518490b909ecb16928dcd7f0bc8154')

# Contributor: Jan de Groot <jgc@archlinux.org>
# Adapted from ABS package
# Maintainer: Jon Nordby <jononor@gmail.com>

_pkgname=pygobject
pkgname=$_pkgname-git
pkgver=20101203
pkgrel=1
pkgdesc="Python bindings for GObject - git version"
arch=('i686' 'x86_64')
license=('LGPL')
depends=('python2' 'glib2>=2.26.0' 'pycairo>=1.8.10' 'gobject-introspection>=0.9.6')
provides=()
depends=()
options=('!libtool')
url="http://www.pygtk.org/"
source=(0001-Build-Accept-libtool-2.4-as-well.patch)
md5sums=('a56989b060909129f1ce71361e5b0e42')

_gitroot="git://git.gnome.org/pygobject"
_gitname="pygobject"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  patch -p1 < "$srcdir"/0001-Build-Accept-libtool-2.4-as-well.patch

  # BUILD
  ./autogen.sh --prefix=/usr
  make
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  make DESTDIR="${pkgdir}" install

  find "$pkgdir"/usr/share/pygobject -name '*.py' | \
    xargs sed -i "s|#![ ]*/usr/bin/env python$|#!/usr/bin/env python2|"
}
